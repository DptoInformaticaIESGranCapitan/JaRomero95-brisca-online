{% set user = app.user %}
<!doctype html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">

    <title>Wreck Them</title>

    {% block stylesheets %}
        <link href="http://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
        {#<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.97.6/css/materialize.min.css">#}
        <link rel="stylesheet" href="{{ asset('css/main.scss') }}">
    {% endblock %}
</head>
<body>


{% block body %}{% endblock %}
{% block scripts %}
    <script src="{{ asset('js/lib/jquery-2.2.3.min.js') }}"></script>
    {#<script src="https://code.jquery.com/jquery-2.2.3.min.js"></script>#}

    {#<script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.97.6/js/materialize.min.js"></script>#}

    {% if user %}
    <script src="{{ asset('js/lib/socket.io-1.4.5.js') }}"></script>
    {#<script src="https://cdn.socket.io/socket.io-1.4.5.js"></script>#}

    <script>
        var name = '{{ user.nick }}';

        $(function () {
            var socket = io('http://localhost:3000');

            function initGame(){
                $action1.prop('disabled', true);
                $action1.click(function(){
                    socket.emit('action1');
                    $action1.prop('disabled', true);
                });
            }

            var $m = $('#m'),
                    $search = $('#search-game'),
                    $action1 = $('#action1');

            socket.emit('join', name);

            $('form').submit(function () {
                var val = $m.val();
                if (val) {
                    socket.emit('msg', val, name);
                    $m.val('');
                }
                return false;
            });

            socket.on('msg', function (msg) {
                $('#messages').append($('<li>').html(
                        '<strong>' + msg.user + ':</strong> ' + msg.msg
                ));
            });

            socket.on('new user', function (user) {
                $('#messages').append($('<li>').html(
                        '<strong>' + user + ' se ha conectado al chat</strong>'
                ));
            });

            $search.click(function () {
                socket.emit('search game');
                $search.prop('disabled', true);
            });

            socket.on('game', function (idGame) {
                console.log('Te has unido a la sala: ' + idGame);
            });

            socket.on('begin', function (data1, data2) {
                $search.prop('disabled', true);
                console.log('¡Comienza la partida!', data1, data2);
//                if(window.location.pathname != '/jugar')
//                    window.location = '/jugar';
            });

            socket.on('turn', function (player, time) {
                if (player === name){
                    console.log('El turno es mío');
                    $action1.prop('disabled', false);
                }
                else{
                    console.log('El turno es de: ' + player);
                    $action1.prop('disabled', true);
                }

                console.log('Tiempo: ' + time);
            });

            initGame();
        });
    </script>

    {#<script src="{{ asset('js/init-socket.js') }}"></script>#}
    {#<script src="{{ asset('js/c-chat-general.js') }}"></script>#}
    {#<script src="{{ asset('js/c-search-game.js') }}"></script>#}

    {% endif %}
{% endblock %}
</body>
</html>